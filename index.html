<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
</head>
<body>
    <div class="con">
        <div class="head">
            <ul class="head_list">
                <li>
                    <img src="./images/logo.jpg"/>
                </li>
                <li>
                    <a href="#">首页</a>
                </li>
                <li>
                    <a href="#">榜单</a>
                </li>
                <li>
                    <a href="#">歌手</a>
                </li>
                <li>
                    <a href="#">下载酷我客户端</a>
                </li>
                <li class="nav-more">
                    <div class="nav-logo"></div>
                    <!-- <img src="./images/sprite1.png" class="nav-logo"/> -->
                    <a href="#">美女秀</a>
                </li>
                <li class="nav-more">
                    <div class="nav-logo"></div>
                    <!-- <img src="./images/sprite1.png" class="nav-logo"/> -->
                    <a href="#">酷我耳机</a>
                </li>
                <li class="nav-more">
                    <div class="nav-logo"></div>
                    <!-- <img src="./images/sprite1.png" class="nav-logo"/> -->
                    <a href="#">VIP会员</a>
                </li>
                <li class="nav-more">
                    <div class="nav-logo"></div>
                    <!-- <img src="./images/sprite1.png" class="nav-logo"/> -->
                    <a href="#">i听</a>
                </li>
                <li class="nav-more serve">
                    <a href="#">更多服务</a>
                </li>
                <li class="nav-more login">
                    <a href="#">登录</a>
                </li>
                <li>
                    <input type="text" placeholder="找到好音乐" class="search">
                </li>
            </ul>
        </div>
        <div class="middle">；
            <div class="lyric">
                <span id="title">喜羊羊</span>
                <p>专辑：<span class="light">儿歌大全</span>  
                    歌手：<span class="light">华语群星</span>  
                    分享 
                    <span id="lyric_comment"></span> 
                    <span class="light">评论</span>
                </p>
                <p>上传时间：2015-10-02 歌曲来源：网络</p>
                <hr/>
                <p class="lyric_content">在所有天气 拥有叫人大笑的力量</p>
                <p class="lyric_content">虽然我只是羊</p>
                <p class="lyric_content">虽然我只是羊</p>
                <p class="lyric_content">喜羊羊 美羊羊 懒羊羊 沸羊羊</p>
                <p class="lyric_content">慢羊羊 软绵绵 红太狼 灰太狼</p>
            </div>
            <div class="player">
                <div class="player_top">
                    <div class="playerTop_con"></div>
                    <div id="player_dec"></div>
                    <div id="player_dec2"></div>
                </div>
                
                <div class="player_mid">
                    <audio autoplay="autoplay" id="myMusic" >
                        <source src="./images/2.mp3" type="audio/mp3">
                    </audio>
                    <div id="playerBtn" class="play"></div>
                    <div id="prograssBar">
                        <div id="slice" style="width: 0%;">
                           <div id="playerSlice" style="width: 0;"></div> 
                           <div id="playerBar" style="left: 0;"></div> 
                        </div>                   
                    </div>
                    <p id="playtime">00:00</p>
                    <div id="sound"></div> 
                </div>
                <div class="downloadBtn">
                    <div class="downloadLogo"></div>
                    <span>免费下载这首歌</span>
                </div>
                <div class="listener">
                    <div class="head_sculpture"></div>
                    <div class="listening">
                        <span class="name">郭子仪——H5班</span>
                        <div class="song">
                            <img src="./images/gif.gif"/>
                            喜羊羊与灰太狼
                            <a href="#">去现场></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom">
            <span>评论</span>
            <span>1703条评论</span>  
            <!-- <hr/> -->
            <div id="comment_area"> 
                <div id="com_sculpture"><img src="images/郭子仪.jpg"></div>
                <textarea id="comment_con" placeholder="分享你的音乐见解"></textarea>
                <div id="com_infor">
                    <div class="com_commenticon"></div>
                    <span class="words_sum">已输入0个字</span>
                    <button id="sub_com">评论</button>
                </div>
            </div>
            <div id="comments">
                <span id="coms_wond">精彩评论</span>
                <div id="com_list">
                    <div class="coms">
                        <div class="list_scu"></div>
                        <p><span class="coms_per">郭子仪</span><span class="coms_share">分享</span></p>
                        <p><span class="comsContent">Too</span></p>
                        <div class="coms_attr">
                            <div class="time"></div>
                            <a href="#" class='del'>删除</a>
                            <div class="good">163<img src="images/bg2.jpg"/></div>
                            <a href="#" class='res'>回复</a>
                        </div>
                    </div>
                </div>    
            </div>
            <div id="pages">
                <div><</div>
                <div>1</div>
                <div>2</div>
                <div>3</div>
                <div>4</div>
                <div>></div>
            </div>
        </div>
    </div>
</body>
<script>
    var playerBtn = document.getElementById("playerBtn");
    var myMusic = document.getElementById("myMusic");
    var playerBar = document.getElementById("playerBar");
    var playtime = document.getElementById("playtime");
    var playerSlice = document.getElementById("playerSlice");
    var slice = document.getElementById("slice");
    var sound = document.getElementById("sound");
    var btn = document.getElementById("sub_com");
    var com_list = document.getElementById("com_list");
    var content = document.getElementById("comment_con");
    var comsContent = document.getElementsByClassName("comsContent")[0];
    var coms = document.getElementsByClassName("coms")[0];
    var ch_btn = document.getElementById('pages');


    function changePages(i){
        var comList = localStorage["comList"]; // 获取本地存储的数据
		comList = JSON.parse(comList);//转换成数组结构
        if(1==i){
            for(var j=0;j<2;j++){
                var comNode = com_list.childNodes[j+3];
                comNode.childNodes[5].innerHTML = "<span class='comsContent'>"+ comList[j].comContent +"</span>";
                comNode.childNodes[7].innerHTML = "<div class='time'>" + comList[j].comTime +'</div>'+"<a href='#' class='del'>删除</a>"
                                                + '<div class="good">163<img src="images/bg2.jpg"/>'+ '</div>' + "<a href='#' class='res'>回复</a>";
            }
        }else{
            for(var j=0;j<2;j++){
                var comNode = com_list.childNodes[j+3];
                comNode.childNodes[5].innerHTML = "<span class='comsContent'>"+ comList[i+j+1].comContent +"</span>";
                comNode.childNodes[7].innerHTML = "<div class='time'>" + comList[i+j+1].comTime +'</div>'+"<a href='#' class='del'>删除</a>"
                                                + '<div class="good">163<img src="images/bg2.jpg"/>'+ '</div>' + "<a href='#' class='res'>回复</a>";
            }
        }
        
    }

    ch_btn.children[1].onclick = function(){
        changePages(1);
    }
    ch_btn.children[2].onclick = function(){
        changePages(2);
    }
    ch_btn.children[3].onclick = function(){
        changePages(3);
    }
    ch_btn.children[4].onclick = function(){
        changePages(4);
    }
    //向本地存储中存储数据
		function saveCom(time,comContent) {
			var comList = localStorage["comList"];
			// console.log(typeof noteList);  undefined
			//一开始没有便签数据，将便签相关数据抽象成对象
			if(comList == "" || comList == null || comList == undefined){
				localStorage["comList"] = "[]"; //只能存基本数据类型，因此存成这样
			}
			//Jasonpass处理
			comList = JSON.parse(localStorage["comList"]);
			// console.log(noteList);  []
			//将便签相关数据定义成对象结构
			var comObj = {comTime: time, comContent: comContent};
			comList.push(comObj);
			// console.log(noteList);  
			localStorage["comList"] = JSON.stringify(comList); //noteList是键名；数组无法自己存，需要转换成json字符串
		}

        

        function addCom(time,comContent) {
            
			var comNode = document.createElement("div");
			var comList = localStorage["comList"];
			comList = JSON.parse(comList);
			var comTime = time;		
			comNode.innerHTML = coms.innerHTML;
            comNode.childNodes[5].innerHTML = "<span class='comsContent'>"+ comContent +"</span>";
            comNode.childNodes[7].innerHTML = "<div class='time'>" + time +'</div>'+"<a href='#' class='del'>删除</a>"
                                            + '<div class="good">163<img src="images/bg2.jpg"/>'+ '</div>' + "<a href='#' class='res'>回复</a>";
			com_list.appendChild(comNode);

		}

        // 获取本地存储数据，并且显示在页面上
		function getComs() {
            var con = coms.innerHTML;
            coms.innerHTML = con;
			var comList = localStorage["comList"]; // 获取本地存储的数据
			comList = JSON.parse(comList);//转换成数组结构
			for(var i = 0; i < comList.length;i++){
				var comNode = document.createElement("div");
            //删除节点的时候要用，noteId
                comNode.innerHTML = con;
                comNode.childNodes[5].innerHTML = "<span class='comsContent'>"+ comList[i]['comContent'] +"</span>";
                comNode.childNodes[7].innerHTML = "<div class='time'>" + comList[i]['comTime'] +'</div>'+"<a href='#' class='del'>删除</a>"
                                            + '<div class="good">163<img src="images/bg2.jpg"/>'+ '</div>' + "<a href='#' class='res'>回复</a>";
				com_list.appendChild(comNode);
			}

		}

        window.onload = function() {
            getComs();
        }

    btn.onclick = function() {
        var con = content.value;
        var date = new Date();
        var year = date.getFullYear();
        var mon = date.getMonth()+1;
        var day = date.getDate();
        var hour = date.getHours();
        var min = date.getMinutes();
        var sec = date.getSeconds();
        var time = year + '-' + mon + "-" + day + ' ' + hour + ":" + min + ':' + sec;
        saveCom(time,con); 
        addCom(time,con);
    }

    var timer;
    var currentTime,min,sec;
    //数字格式
    function numForm(num) {
        return(num<10?'0'+num:''+num);
    }

//进度条，开始和暂停
    playerBtn.onclick = function() {
        // playerBtn
        if(myMusic.paused) {
            myMusic.play();
            playerBtn.className = 'zan';

            timer = setInterval(function(){
                currentTime = myMusic.currentTime;
                min = parseInt(currentTime/60);
                sec = parseInt(currentTime%60);
                playtime.innerHTML = numForm(min) + ':' + numForm(sec);
                pro = currentTime / myMusic.duration;
                slice.style.width = pro*100 + '%';
                playerSlice.style.width = pro*300 + 'px';
                playerBar.style.left =  300 * pro + 'px';
            },1000);
        }else{
            myMusic.pause();
            playerBtn.className = 'play';
            clearInterval(timer);
        }
    }

    //静音
    sound.onclick = function() {
        if(!myMusic.muted) {
            myMusic.muted = true;
        }else {
            myMusic.muted = false;
        }
    }



</script>
</html>